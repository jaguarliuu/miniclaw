spring:
  application:
    name: miniclaw
  profiles:
    default: sqlite

  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: true
    properties:
      hibernate:
        format_sql: true

  flyway:
    enabled: true
    baseline-on-migrate: true

server:
  port: 8080

# Actuator 健康检查
management:
  endpoints:
    web:
      exposure:
        include: health
  endpoint:
    health:
      show-details: never

# LLM 配置
llm:
  # 使用 OpenAI 兼容接口（可替换为 DeepSeek、通义千问、Ollama、GLM 等）
  # 路径自动处理：若不以 /v* 结尾，自动追加 /v1
  # Ollama: http://localhost:11434
  # DeepSeek: https://api.deepseek.com
  # 通义千问: https://dashscope.aliyuncs.com/compatible-mode
  # GLM (智谱): https://open.bigmodel.cn/api/paas/v4  (已含 /v4，不会再追加)
  endpoint: ${LLM_ENDPOINT:}
  api-key: ${LLM_API_KEY:}
  model: ${LLM_MODEL:}
  temperature: 0.7
  max-tokens: 8192
  timeout: 300

# MiniClaw 配置
miniclaw:
  config-dir: ${MINICLAW_CONFIG_DIR:./data}
  webapp-dir: ${MINICLAW_WEBAPP_DIR:}

# Agent 配置
agent:
  system-prompt: |
    你是一个有帮助的 AI 助手。请用中文回答用户的问题。
    回答要简洁、准确、有条理。
  max-history-messages: 20
  loop:
    max-steps: 50
    run-timeout-seconds: 1200
    step-timeout-seconds: 300
  hitl:
    timeout-seconds: 300  # HITL 确认超时时间（5分钟）

# Tools 配置
tools:
  workspace: ${TOOLS_WORKSPACE:./workspace}
  max-file-size: 1048576  # 1MB
skills:
  watch-enabled: true  # 是否启用热更新
  index-token-budget: 2000  # 索引 token 预算

# Agent Profiles 配置（多主代理身份）
agents:
  default-agent: main
  profiles:
    main:
      sandbox: trusted
      tools:
        allow: []  # 空表示允许所有
        deny: []
      workspace: ./workspace
      auth-dir: ./.miniclaw/auth/main
      can-spawn: true
    restricted:
      sandbox: restricted
      tools:
        allow: [read_file, http_get, memory_search]
        deny: [shell, shell_start, write_file, sessions_spawn]
      workspace: ./workspace/restricted
      auth-dir: ./.miniclaw/auth/restricted
      can-spawn: false
  lane:
    main-max-concurrency: 4
    subagent-max-concurrency: 8

# Memory 配置（全局记忆，跨会话）
memory:
  path: memory  # 相对于 workspace
  chunk:
    target-tokens: 400
    overlap-tokens: 80
  embedding:
    provider: none  # auto / openai / llm / none
  search:
    vector-top-k: 10
    fts-top-k: 10
    final-top-k: 5
    snippet-max-chars: 700
    min-similarity: 0.3
  flush:
    enabled: true
    token-threshold: 100000

# Node Console 配置（远程机器管理）
node-console:
  encryption-key: ${NODE_CONSOLE_ENCRYPTION_KEY:}
  default-safety-policy: strict