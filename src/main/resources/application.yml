spring:
  application:
    name: miniclaw
  profiles:
    default: sqlite

  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false
    properties:
      hibernate:
        format_sql: false

  flyway:
    enabled: true
    baseline-on-migrate: true

# 日志配置
logging:
  file:
    name: ${MINICLAW_CONFIG_DIR:./data}/logs/miniclaw.log
  logback:
    rollingpolicy:
      max-file-size: 10MB
      max-history: 7
  level:
    root: INFO
    com.jaguarliu: DEBUG

server:
  port: 8080

# Actuator 健康检查
management:
  endpoints:
    web:
      exposure:
        include: health
  endpoint:
    health:
      show-details: never

# LLM 配置
llm:
  # 使用 OpenAI 兼容接口（可替换为 DeepSeek、通义千问、Ollama、GLM 等）
  # 路径自动处理：若不以 /v* 结尾，自动追加 /v1
  # Ollama: http://localhost:11434
  # DeepSeek: https://api.deepseek.com
  # 通义千问: https://dashscope.aliyuncs.com/compatible-mode
  # GLM (智谱): https://open.bigmodel.cn/api/paas/v4  (已含 /v4，不会再追加)
  endpoint: ${LLM_ENDPOINT:}
  api-key: ${LLM_API_KEY:}
  model: ${LLM_MODEL:}
  temperature: 0.7
  max-tokens: 8192
  timeout: 300

# MiniClaw 配置
miniclaw:
  config-dir: ${MINICLAW_CONFIG_DIR:./data}
  webapp-dir: ${MINICLAW_WEBAPP_DIR:}

# Agent 配置
agent:
  system-prompt: |
    你是一个有帮助的 AI 助手。请用中文回答用户的问题。
    回答要简洁、准确、有条理。
  max-history-messages: 20
  loop:
    max-steps: 50
    run-timeout-seconds: 1200
    step-timeout-seconds: 300
  hitl:
    timeout-seconds: 300  # HITL 确认超时时间（5分钟）

# Tools 配置
tools:
  workspace: ${TOOLS_WORKSPACE:./workspace}
  max-file-size: 20971520  # 20MB
  upload-dir: uploads
skills:
  project-dir: ""
  user-dir: ""
  builtin-dir: ""
  watch-enabled: true  # 是否启用热更新
  index-token-budget: 2000  # 索引 token 预算

# Agent Profiles 配置（多主代理身份）
agents:
  default-agent: main
  profiles:
    main:
      sandbox: trusted
      tools:
        allow: []  # 空表示允许所有
        deny: []
      workspace: ./workspace
      auth-dir: ./.miniclaw/auth/main
      can-spawn: true
    restricted:
      sandbox: restricted
      tools:
        allow: [read_file, http_get, memory_search]
        deny: [shell, shell_start, write_file, sessions_spawn]
      workspace: ./workspace/restricted
      auth-dir: ./.miniclaw/auth/restricted
      can-spawn: false
  lane:
    main-max-concurrency: 4
    subagent-max-concurrency: 8

# Memory 配置（全局记忆，跨会话）
memory:
  path: memory  # 相对于 workspace
  chunk:
    target-tokens: 400
    overlap-tokens: 80
  embedding:
    provider: none  # auto / openai / llm / none
  search:
    vector-top-k: 10
    fts-top-k: 10
    final-top-k: 5
    snippet-max-chars: 700
    min-similarity: 0.3
  flush:
    enabled: true
    token-threshold: 100000

# MCP (Model Context Protocol) 配置
# 作为 MCP Client，连接到任意 MCP Server（官方、第三方、用户自建）
# 支持三种传输方式：STDIO（进程管道）、SSE（服务器推送事件）、HTTP（流式HTTP）
mcp:
  servers: []  # 默认为空，用户可以添加任意数量的 MCP Server
    # ========================================
    # 官方 MCP Server 示例（STDIO）
    # ========================================
    # - name: filesystem
    #   transport: stdio
    #   command: npx
    #   args:
    #     - "-y"
    #     - "@modelcontextprotocol/server-filesystem"
    #     - "/tmp"
    #   enabled: true
    #   tool-prefix: fs_
    #   request-timeout-seconds: 30
    #
    # ========================================
    # 第三方 MCP Server 示例（SSE）
    # ========================================
    # - name: tavily-search
    #   transport: sse
    #   url: http://localhost:3000/sse
    #   enabled: true
    #   tool-prefix: search_
    #   requires-hitl: false
    #
    # ========================================
    # 用户自定义 MCP Server 示例（HTTP）
    # ========================================
    # - name: my-custom-mcp
    #   transport: http
    #   url: http://localhost:8080/mcp
    #   enabled: true
    #   tool-prefix: custom_
    #   hitl-tools: [delete_data, update_config]
    #
    # ========================================
    # 用户自定义本地 MCP Server（STDIO）
    # ========================================
    # - name: my-python-mcp
    #   transport: stdio
    #   command: python
    #   args:
    #     - "/path/to/my_mcp_server.py"
    #   working-dir: /path/to/workdir
    #   env:
    #     - "API_KEY=your-key"
    #     - "DEBUG=true"
    #   enabled: true
    #   tool-prefix: py_
    #   request-timeout-seconds: 60
  health-check:
    interval-seconds: 60
    max-retries: 3
    retry-backoff-seconds: 5

# (files 配置已移至 tools.upload-dir)

# Node Console 配置（远程机器管理）
node-console:
  encryption-key: ${NODE_CONSOLE_ENCRYPTION_KEY:}
  default-safety-policy: strict
  ssh-connect-timeout-seconds: 10  # SSH 连接超时
  exec-timeout-seconds: 60         # 命令执行超时
  max-output-bytes: 32000          # 最大输出字节数（防止 OOM）