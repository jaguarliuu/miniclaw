# 文件夹选择功能使用指南

## 功能概览

在 MiniClaw 中添加 Folder 上下文时，您现在有两种方式选择文件夹：
1. **图形界面选择**（推荐）：点击 "📁 Browse" 按钮，通过对话框选择
2. **手动输入**：直接在输入框中输入文件夹路径

## 使用步骤

### 方法 1：使用图形界面选择（推荐）

#### 步骤 1: 打开上下文菜单
在消息输入框左侧，点击 **+** 按钮

```
┌─────────────────────────────────────────┐
│  [+]  Type your message...         [↑]  │
└─────────────────────────────────────────┘
  ↑
  点击这里
```

#### 步骤 2: 选择 Folder 类型
在弹出的菜单中，点击 **📁 Folder**

```
┌─────────────────────────────┐
│  📄 File                    │
│     Upload a local file     │
├─────────────────────────────┤
│  📁 Folder    ← 点击这里     │
│     Reference a folder path │
├─────────────────────────────┤
│  🌐 Web                     │
│     Fetch content from URL  │
└─────────────────────────────┘
```

#### 步骤 3: 点击 Browse 按钮
在弹出的对话框中，点击 **📁 Browse** 按钮

```
┌────────────────────────────────────────┐
│  Add Folder Path                    ×  │
├────────────────────────────────────────┤
│                                        │
│  ┌─────────────────────┬────────────┐ │
│  │ workspace/src       │ 📁 Browse │ │
│  └─────────────────────┴────────────┘ │
│        ↑                     ↑         │
│    可手动输入          或点击浏览按钮   │
│                                        │
│  ┌────────┐  ┌────────┐               │
│  │ Cancel │  │  Add   │               │
│  └────────┘  └────────┘               │
└────────────────────────────────────────┘
```

#### 步骤 4: 选择文件夹

**Electron 桌面版**：
- 会打开系统原生的文件夹选择对话框
- Mac: Finder 选择对话框
- Windows: 资源管理器选择对话框

```
macOS Finder:
┌────────────────────────────────────────┐
│  Choose a folder                    ×  │
├────────────────────────────────────────┤
│  ⚙️  Desktop                           │
│  📁 Documents                          │
│  📁 Downloads                          │
│  📂 workspace                          │
│     ├─ 📁 src       ← 选择这个文件夹   │
│     ├─ 📁 uploads                      │
│     └─ 📁 memory                       │
│                                        │
│           [Cancel]  [Choose]           │
└────────────────────────────────────────┘
```

**Web 浏览器版**：
- 会打开浏览器的文件夹选择器
- 选择文件夹后会提取文件夹名称

#### 步骤 5: 确认添加
选择文件夹后，路径会自动填充到输入框，点击 **Add** 按钮

```
┌────────────────────────────────────────┐
│  Add Folder Path                    ×  │
├────────────────────────────────────────┤
│                                        │
│  ┌─────────────────────┬────────────┐ │
│  │ /Users/you/workspace│ 📁 Browse │ │
│  │ /src                │            │ │
│  └─────────────────────┴────────────┘ │
│    ↑ 路径已自动填充                    │
│                                        │
│  ┌────────┐  ┌────────┐               │
│  │ Cancel │  │  Add   │  ← 点击添加   │
│  └────────┘  └────────┘               │
└────────────────────────────────────────┘
```

#### 步骤 6: 查看已添加的文件夹
文件夹上下文会以芯片形式显示在输入框上方

```
┌─────────────────────────────────────────┐
│  ┌──────────────────────────────────┐  │
│  │ 📁 FOLDER  workspace/src    ×    │  │
│  └──────────────────────────────────┘  │
│                                         │
│  [+]  Ask me about this folder... [↑]  │
└─────────────────────────────────────────┘
```

### 方法 2：手动输入路径

如果您知道确切的路径，可以直接输入：

#### 相对路径示例
```
workspace/src
workspace/uploads
data/config
```

#### 绝对路径示例（桌面版）
```
/Users/username/Documents/MyProject
C:\Users\username\Documents\MyProject
/home/username/projects/app
```

#### 注意事项
- ✅ 路径不能包含 `..`（安全限制）
- ✅ 使用 `/` 作为路径分隔符（跨平台兼容）
- ✅ Windows 用户也可以使用 `/` 代替 `\`

## 发送消息

添加文件夹上下文后，输入您的问题并发送。Agent 会看到如下 prompt：

```
[Attached Folders]
- workspace/src (explore using glob/grep/read_file)

Please list all TODO comments in this folder
```

Agent 会自动使用 `glob`、`grep`、`read_file` 等工具来探索文件夹内容。

## 使用示例

### 示例 1: 分析源代码文件夹
```
1. 添加文件夹: workspace/src
2. 输入问题: "Find all TODO comments in this folder"
3. Agent 使用 grep 搜索 TODO → 列出所有待办事项
```

### 示例 2: 查找配置文件
```
1. 添加文件夹: workspace/config
2. 输入问题: "What configuration files are in this folder?"
3. Agent 使用 glob 列出文件 → 读取并解释配置
```

### 示例 3: 代码审查
```
1. 添加文件夹: workspace/src/components
2. 输入问题: "Review the Vue components in this folder"
3. Agent 使用 glob 找到 .vue 文件 → 逐个分析代码质量
```

### 示例 4: 文档生成
```
1. 添加文件夹: workspace/src/api
2. 输入问题: "Generate API documentation for this folder"
3. Agent 读取所有 API 文件 → 生成文档
```

## 常见问题

### Q1: Browse 按钮没有反应？

**可能原因**：
- 浏览器不支持文件夹选择（较旧的浏览器）
- 桌面版的 Electron 环境未正确初始化

**解决方案**：
- 使用手动输入方式
- 更新到最新版本的浏览器
- 重启桌面应用

### Q2: 选择的文件夹路径太长，无法完整显示？

**解决方案**：
- 输入框支持滚动，可以查看完整路径
- 鼠标悬停在文件夹芯片上，会显示完整信息（未来功能）
- 使用相对路径而不是绝对路径

### Q3: Agent 无法访问选择的文件夹？

**可能原因**：
- 文件夹路径不在 workspace 范围内（安全限制）
- 文件夹不存在或已被删除
- 权限不足

**解决方案**：
- 确保文件夹路径正确
- 使用 workspace 目录下的文件夹
- 检查文件系统权限

### Q4: Web 环境和桌面版有什么区别？

| 功能 | Web 浏览器 | Electron 桌面版 |
|------|-----------|----------------|
| 文件夹选择 | ✅ 浏览器选择器 | ✅ 系统原生对话框 |
| 路径格式 | 相对路径/文件夹名 | 绝对路径 |
| 手动输入 | ✅ 支持 | ✅ 支持 |
| 权限 | 浏览器沙箱限制 | 系统级权限 |

### Q5: 可以一次添加多个文件夹吗？

**答案**：可以！
1. 重复添加文件夹上下文的步骤
2. 每个文件夹会显示为单独的芯片
3. Agent 会依次处理所有文件夹

示例：
```
┌─────────────────────────────────────────┐
│  ┌──────────────────────────────────┐  │
│  │ 📁 FOLDER  workspace/src    ×    │  │
│  └──────────────────────────────────┘  │
│  ┌──────────────────────────────────┐  │
│  │ 📁 FOLDER  workspace/tests  ×    │  │
│  └──────────────────────────────────┘  │
│  ┌──────────────────────────────────┐  │
│  │ 📁 FOLDER  workspace/docs   ×    │  │
│  └──────────────────────────────────┘  │
│                                         │
│  [+]  Compare these folders...     [↑] │
└─────────────────────────────────────────┘
```

## 键盘快捷键

| 快捷键 | 功能 |
|--------|------|
| `Enter` | 确认添加文件夹 |
| `Escape` | 取消并关闭对话框 |
| `Tab` | 在输入框和按钮之间切换焦点 |

## 提示和技巧

### 💡 提示 1: 使用相对路径
在桌面版中，使用相对于 workspace 的路径更便于移植：
```
✅ 推荐: workspace/src
❌ 不推荐: /Users/john/MiniClaw/workspace/src
```

### 💡 提示 2: 组合使用文件和文件夹
您可以同时添加文件和文件夹上下文：
```
📄 File: workspace/config/app.yml
📁 Folder: workspace/src
📁 Folder: workspace/tests

问题: "Check if the tests match the implementation"
```

### 💡 提示 3: 指定探索深度
在问题中明确指定需要的深度：
```
添加文件夹: workspace/src
问题: "List all .ts files in this folder (including subfolders)"
```

### 💡 提示 4: 使用过滤条件
让 Agent 只关注特定文件：
```
添加文件夹: workspace/src
问题: "Find all .vue files that contain 'TODO' comments"
```

## 安全提示

⚠️ **注意**：
- 选择文件夹时请确保不包含敏感信息
- Agent 可以读取文件夹中的所有文件内容
- 不要选择系统关键目录（如 `/System`、`C:\Windows` 等）
- 文件夹路径会包含在 prompt 中发送给 LLM

## 反馈和建议

如果您在使用文件夹选择功能时遇到问题或有改进建议，欢迎：
- 在 GitHub 提交 Issue
- 加入社区讨论
- 联系技术支持

---

**版本**: 1.0.0
**最后更新**: 2024-02-10
**适用于**: MiniClaw Web 和 Electron 桌面版
